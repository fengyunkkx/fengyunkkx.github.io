---
layout:     post
title:      "解决 Windows 10 下右键无法新建文件的思路和方法"
date:       2017-08-01 19:23:01
author:     "沨沄极客"
header-img: "img/in-post/2017-08-01-Windows-10-problem/title-pic.png"
header-mask: 0.3
catalog:    true
tags:
    - Windows
    - 方法论
---

# 解决 Windows 10 下右键无法新建文件的思路和方法

「 Windows 10 中右键无法新建文件」，这两天被这个问题搞的非常头疼，还是 Windows 10 中新出现的问题，网上相关的解决方法很少。

这个症状具体表现为，右键 → 新建，然后卡住，文件资源管理器崩溃。

刚开始发现这个状况没有太在意，以为是某些软件偶尔有冲突，就没有去管。结果过了两天发现这个问题越来越严重，已经影响到我的日常使用了。这才开始正视这个问题。



## 直接上干货，问题的解决方法

1、下载安装 RightMenuMgr 这个右键菜单管理软件。

2、在「Explorer」→「目录」→「背景(桌面)」→「新建」中，依次取消勾选可能导致问题的「扩展项」。

![07 右键菜单](https://i.loli.net/2017/08/17/59947edd21292.png)

比如我的问题出在了新建「.bmp」「.psd」文件上，取消勾选它们即可解决问题。

由于 Windows 10 更新频繁，发生的问题千奇百怪，这个方法并不能保证 100 % 解决问题。如果无效请试试看其他的方法，可能问题并不是出在这里。

在 Windows 中遇到这类小问题非常痛苦，因为如果不能解决问题，通常只有「继续忍受」和「重装系统」两条路可走。

自己解决问题，永远比按照教程操作要困难得多。下面是我解决问题的一些思路，希望对各位有所帮助。

## 首先尝试查看系统日志

右键此电脑 → 管理 → Windows 日志 → 应用程序。

找到了最近几次的崩溃信息。通常会显示是什么软件的崩溃导致的问题。但是很奇怪，这次的错误模块居然是 Explorer.exe 的 SHELL32.dll，Explorer.exe 是文件资源管理器，SHELL32.dll 是管理系统图标的一个 dll，我开始怀疑是由于「新建」目录中的图标引起的崩溃问题。

![01 崩溃信息1](https://ooo.0o0.ooo/2017/08/17/59947ee102c33.png)

与之相近的一个崩溃信息是关于 Microsoft.StickyNotes.exe 的。也就是关于 Windows 自带的便利贴的错误。

但是我多次尝试后，发现这两个错误没有必然联系。所以便利贴的错误应该是由于文件资源管理器崩溃产生的。而不是导致崩溃的原因。

![02 崩溃信息2](https://i.loli.net/2017/08/17/59947ee660c35.png)

附近还有一个崩溃信息，可能是造成这个问题的原因，与上面两个问题不同，它的事件 ID 是 10016，从描述上看，应该是网络连接方面的错误。

> APPID 为 {B0316D0C-DA2F-40E0-9F91-F600CAF042DC} 的 COM 服务器应用程序的 本地 激活 权限。此安全权限可以使用组件服务管理工具进行修改。

![03 崩溃信息3](https://i.loli.net/2017/08/17/59947ee92a26a.png)

## 分析问题所在

那么现在有三个方向

1. 解决 SHELL32.dll 问题
2. 解决 Microsoft.StickyNotes.exe 的问题
3. 解决 COM 服务器权限

这三点中最可能出现，也是最难解决的就是第一点。因为 SHELL32.dll 是系统文件，一般 dll 文件出了问题，要么下载替换，要么重装系统。

考虑到 SHELL32.dll 这个文件是 Windows 最大的图标库，我认为问题也可能出现在图标、缩略图等方面。

第二点也比较难以理解，StickyNotes 虽然之前出现过乱码问题，但应该不至于导致「新建」出错。更何况新建中并没有便利贴的存在。

第三点我在之后对其进行了一定的了解，发现跟本问题无关。就没有继续研究下去。

所以我要着重解决与 SHELL32.dll 、图标相关的问题。

## 重新注册 SHELL32.dll

既然问题的根源还没有找到，先从 SHELL32.dll 入手吧。

先在「运行」中输入 `gsvr32 shell32.dll` ，重新激活一下 SHELL32.dll。问题依旧，没有卵用。

## 尝试卸载可能导致冲突的软件

其实我这时候仍然不是很想动 SHELL32.dll 这种系统文件。

我试着回忆出现这个问题的时间，把出现问题之后安装的各种软件，大部分尝试卸载了一遍。

我又把最近的几次系统更新卸载，依然没有解决问题。

![04 系统更新](https://i.loli.net/2017/08/17/59947eef46931.png)

其他可能导致这个问题的软件有「Fences」「MacType」「NetDrive 2」等与文件资源管理器密切相关的软件。

无论是禁用这些软件、还原之前的配置，还是卸载。结果没有任何用处，都不能解决问题。

经过一番爬贴，有人表示 SketchUp、Autodesk 系列软件会导致无法新建文件等情况。 我把 Sketch Up 卸载，没有用。

网上许多帖子的情况是「无法新建文件夹」，这个是权限问题，我很清楚这两个问题没有关联，我只是打不开「新建菜单」而已。

后来在这个帖子里，遇到了一样的情况，没有解决方法。

http://bbs.pcbeta.com/forum.php?mod=viewthread&tid=1739914

但是评论中提到 MacType，我把 MacType 还原系统默认设置后，彻底删除，清空注册表。问题依然没有得到解决。

## 逼上绝路，替换 SHELL32.dll

最终我尝试替换 SHELL32.dll。我先创建了系统还原点，万一替换出了问题，还可以通过系统还原点还原回来。

![05 系统还原点](https://i.loli.net/2017/08/17/59947ef80e869.png)

随后我修改了 C:\Windows\System32\SHELL32.dll 的所有者为 Users，然后给 Users 赋予完全控制权限。

![06 shell32.dll 的权限](https://i.loli.net/2017/08/17/59947f024a822.png)

把 SHELL32.dll 替换为网上下载的版本，问题没有解决。

重启电脑，无限菊花，无法启动。

无奈，只能恢复到还原点配置。

## 查看新建菜单选项

由于替换 SHELL32.dll 会出问题，我觉得可能需要重装系统了。

然后突然想到看一下右键菜单里有哪些奇怪的文件。

我使用了 RightMenuMgr 这个右键菜单管理软件，直接把「新建」中所有的项目取消勾选了。

![07 右键菜单](https://i.loli.net/2017/08/17/59947efedb0d5.png)

结果成功了！

右键新建可以正常打开，显示「无」。

然后我一一排查，发现新建 .bmp 文件和 .psd 文件的选项会出现问题。

取消了这两项之后就可以正常使用了。

## 结果存疑

其实在最早的时候，我还用软媒魔方的「魔方设置大师」查看过右键菜单中的新建栏，没有发现什么奇怪的选项。而且全部取消没有作用，所以我以为跟这个没有关系。现在想来，可能与两个软件进行设置的方式有关吧。

但是我仍然有疑问，因为我没有对 Photoshop 做过修改。怎么会突然出现这种问题呢？

后来我偶然想到这两天正在玩 3D 打印机。我猜想可能在打开 bmp 文件时，选择了默认使用某软件打开（比如 3D 画图、SketchUp）。这些软件很不巧地与其他软件有冲突，导致了无法正常加载新建菜单。

也有可能在于某个选项的图标缓存出现了问题，比如 bmp 格式在 SHELL32.dll 中的图标文件出了问题，导致无法加载新建图标。

当然这个锅也可能是 Windows 提供的某个补丁，与电脑中的某个软件不兼容引起的。毕竟这个问题是在 Windows 10 Creator 版本之后才出现的，网上的相关资料也很少。

以上这些当然只是推论。总之问题解决了，避免了一次无谓的重装系统，已经算是很高兴了。所以我把这次经历写出来，希望能帮到跟我一样碰到这种情况的人。

注：我的系统是 Windows 10 专业版，详细版本号是 15063.483。

本文由我撰写，首发于 [少数派](https://sspai.com/post/40227)。
